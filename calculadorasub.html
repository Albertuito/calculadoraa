<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Calculadora Subrogación de Hipoteca</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root{
      --panel:#121a2a;
      --ink:#fff;
      --muted:#9fb0c9;
      --accent:#f3b014;
      --stroke:rgba(255,255,255,.08);
      --stroke-strong:rgba(243,176,20,.45);
    }
    body{
      background:#0b1220;
      color:var(--ink);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,sans-serif;
      padding:30px;
    }
    .hh-row{max-width:1100px;margin:auto;}
    .hh-col{max-width:360px;display:flex;}
    .hh-card{
      background:var(--panel);
      color:var(--ink);
      border:1px solid var(--stroke);
      border-radius:14px;
      padding:16px;
      width:100%;
      display:flex;
      flex-direction:column;
      gap:.75rem;
    }
    .hh-card.highlight{
      border-color:var(--stroke-strong);
      box-shadow:0 0 0 1px var(--stroke-strong),0 10px 24px rgba(243,176,20,.12);
    }
    #pro-card{
      background:radial-gradient(1200px 400px at 100% 0%, rgba(243,176,20,.08), transparent 60%),linear-gradient(180deg, rgba(255,255,255,.04), transparent 30%);
      border:1px solid rgba(243,176,20,.35);
      box-shadow:0 0 0 1px rgba(243,176,20,.25),0 12px 28px rgba(243,176,20,.18),inset 0 1px 0 rgba(255,255,255,.06);
    }
    .hh-head{display:flex;justify-content:space-between;align-items:flex-end;}
    .hh-title{font-size:1rem;font-weight:800;color:#fff;margin:0;}
    .hh-pill{font-size:.75rem;padding:.25rem .6rem;border-radius:999px;color:var(--accent);background:rgba(243,176,20,.14);border:1px solid rgba(243,176,20,.35);font-weight:700;}
    .sub{color:var(--muted);font-size:.9rem;}
    .input-group-text{background:transparent;color:#fff;border-color:var(--stroke);}
    .form-control{background:rgba(255,255,255,.06)!important;color:#fff!important;border-color:var(--stroke);}
    .form-control::placeholder{color:#9fb0c9;opacity:.7;}
    .fig{font-weight:900;font-size:1.55rem;line-height:1;}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:.5rem .75rem;}
    .label-sm{color:var(--muted);font-size:.85rem;}
    .val{font-weight:700;}
    #std-total,#pro-total{
      background:var(--accent);color:#111;
      padding:2px 10px;border-radius:10px;font-weight:900;
      box-shadow:0 0 0 1px rgba(0,0,0,.25),0 4px 16px rgba(243,176,20,.25);
    }
    .ribbon{
      position:absolute;top:85px;right:10px;background:var(--accent);
      color:#111;font-weight:900;padding:6px 10px;border-radius:999px;
      box-shadow:0 6px 16px rgba(243,176,20,.3);font-size:.9rem;
    }
    .save-wrap{border:1px dashed var(--accent);background:rgba(243,176,20,.10);border-radius:10px;padding:10px;}
    .save-fig{font-weight:900;font-size:1.25rem;}
    .save-muted{color:var(--muted);font-size:.85rem;}
    .save-row{display:flex;gap:16px;flex-wrap:wrap;align-items:baseline;}
    .save-row>div{display:flex;flex-direction:column;}
    .two{display:grid;grid-template-columns:1fr 1fr;gap:.5rem;}
    @media (max-width: 992px){ .two{grid-template-columns:1fr;} .hh-col{max-width:none;} }
  </style>
</head>
<body>
<div class="hh-row">
  <div class="row g-3 justify-content-center align-items-stretch">

    <!-- ENTRADA: PARÁMETROS SUBROGACIÓN -->
    <div class="col-12 col-lg-4 hh-col">
      <div class="hh-card">
        <div class="hh-head">
          <h3 class="hh-title">Datos para subrogación</h3>
          <span class="hh-pill">Entrada</span>
        </div>

        <div class="mb-1">
          <label class="label-sm mb-1">Capital pendiente</label>
          <div class="input-group">
            <span class="input-group-text">€</span>
            <input id="capPend" type="text" inputmode="decimal" class="form-control" placeholder="150.000">
          </div>
        </div>

        <div class="two">
          <div class="mb-1">
            <label class="label-sm mb-1">Años restantes</label>
            <input id="yearsLeft" type="number" min="1" max="40" class="form-control" placeholder="25">
          </div>
          <div class="mb-1">
            <label class="label-sm mb-1">TIN actual (%)</label>
            <input id="tinOld" type="text" inputmode="decimal" class="form-control" placeholder="3,00">
          </div>
        </div>

        <div class="two">
          <div class="mb-1">
            <label class="label-sm mb-1">TIN nuevo (%)</label>
            <input id="tinNew" type="text" inputmode="decimal" class="form-control" placeholder="2,10">
          </div>
          <div class="mb-1">
            <label class="label-sm mb-1">Comisión subrogación (%)</label>
            <input id="feePct" type="text" inputmode="decimal" class="form-control" placeholder="0,15">
          </div>
        </div>

        <div class="mb-1">
          <label class="label-sm mb-1">Gastos (tasación, gestoría, etc.)</label>
          <div class="input-group">
            <span class="input-group-text">€</span>
            <input id="otherCosts" type="text" inputmode="decimal" class="form-control" placeholder="900">
          </div>
        </div>

        <div class="sub">Edita los valores para ver el ahorro mensual y total.</div>
      </div>
    </div>

    <!-- SITUACIÓN ACTUAL -->
    <div class="col-12 col-lg-4 hh-col">
      <div class="hh-card" id="bank-card">
        <div class="hh-head">
          <h3 class="hh-title">Mantener hipoteca actual</h3>
          <span class="hh-pill">Actual</span>
        </div>
        <div class="d-flex align-items-baseline gap-2 mb-1">
          <div id="old-monthly" class="fig">—</div><div class="sub">/mes aprox.</div>
        </div>
        <div id="old-sub" class="sub mb-2">TIN — · Plazo — · Capital —</div>
        <div class="grid">
          <div><div class="label-sm">Capital pendiente</div><div id="old-capital" class="val">—</div></div>
          <div><div class="label-sm">Intereses por pagar</div><div id="old-interest" class="val">—</div></div>
          <div><div class="label-sm">Comisiones/gastos</div><div id="old-fees" class="val">—</div></div>
          <div><div class="label-sm">Coste total restante</div><div id="old-total" class="val">—</div></div>
        </div>
      </div>
    </div>

    <!-- SUBROGACIÓN NUEVA -->
    <div class="col-12 col-lg-4 hh-col">
      <div class="hh-card highlight position-relative" id="pro-card">
        <div class="ribbon" id="ribbon-save">Ahorro: —</div>
        <div class="hh-head">
          <h3 class="hh-title">Con subrogación</h3>
          <span class="hh-pill">Nuevo</span>
        </div>
        <div class="d-flex align-items-baseline gap-2 mb-1">
          <div id="new-monthly" class="fig">—</div><div class="sub">/mes aprox.</div>
        </div>
        <div id="new-sub" class="sub mb-2">TIN — · Plazo — · Capital —</div>
        <div class="grid mb-2">
          <div><div class="label-sm">Capital financiado</div><div id="new-capital" class="val">—</div></div>
          <div><div class="label-sm">Intereses totales</div><div id="new-interest" class="val">—</div></div>
          <div><div class="label-sm">Comisión + gastos</div><div id="new-fees" class="val">—</div></div>
          <div><div class="label-sm">Coste total préstamo</div><div id="new-total" class="val">—</div></div>
        </div>
        <div class="save-wrap">
          <div class="save-row">
            <div><span class="save-muted">Ahorro total</span><span id="save-total" class="save-fig">—</span></div>
            <div><span class="save-muted">Ahorro mensual</span><span id="save-month" class="save-fig">—</span></div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<script>
// Utils
const fmtMoney=v=>isFinite(v)?new Intl.NumberFormat('es-ES',{style:'currency',currency:'EUR',maximumFractionDigits:0}).format(v):'—';
const fmtPct=v=>isFinite(v)?(v).toFixed(2).replace('.',',')+'%':'—';
const parseNum=s=>{
  if(typeof s!=='string') return Number(s)||0;
  return parseFloat(s.replace(/\./g,'').replace(/,/g,'.').replace(/[^\d.\-]/g,''))||0;
};
const monthlyPayment=(P,annual,years)=>{
  const r=annual/12, n=years*12;
  if(!isFinite(P)||P<=0||!isFinite(annual)||years<=0) return 0;
  return r===0?P/n:P*r/(1-Math.pow(1+r,-n));
};

// DOM
const $=id=>document.getElementById(id);
const inputs=['capPend','yearsLeft','tinOld','tinNew','feePct','otherCosts'].map(id=>$(id));

function computeAll(){
  // Leer entradas
  const capital = parseNum($('capPend').value || '150000');
  const years   = Math.max(1, Math.min(40, parseInt($('yearsLeft').value || '25',10)));
  const tinOld  = parseNum($('tinOld').value || '3')/100;
  const tinNew  = parseNum($('tinNew').value || '2.1')/100;
  const feePct  = parseNum($('feePct').value || '0.15')/100;
  const other   = parseNum($('otherCosts').value || '900');

  // Actual
  const oldPay = monthlyPayment(capital, tinOld, years);
  const oldInterest = oldPay*years*12 - capital;
  const oldFees = 0; // mantener no añade gastos
  const oldTotal = capital + oldInterest + oldFees;

  // Nueva subrogación
  const newPay = monthlyPayment(capital, tinNew, years);
  const newInterest = newPay*years*12 - capital;
  const newFees = capital*feePct + other;
  const newTotal = capital + newInterest + newFees;

  // Render Actual
  $('old-monthly').textContent = fmtMoney(oldPay);
  $('old-sub').textContent = `TIN ${fmtPct(tinOld*100)} · Plazo ${years} años · Capital ${fmtMoney(capital)}`;
  $('old-capital').textContent = fmtMoney(capital);
  $('old-interest').textContent = fmtMoney(oldInterest);
  $('old-fees').textContent = fmtMoney(oldFees);
  $('old-total').textContent = fmtMoney(oldTotal);

  // Render Nueva
  $('new-monthly').textContent = fmtMoney(newPay);
  $('new-sub').textContent = `TIN ${fmtPct(tinNew*100)} · Plazo ${years} años · Capital ${fmtMoney(capital)}`;
  $('new-capital').textContent = fmtMoney(capital);
  $('new-interest').textContent = fmtMoney(newInterest);
  $('new-fees').textContent = fmtMoney(newFees);
  $('new-total').textContent = fmtMoney(newTotal);

  // Ahorros
  const saveTotal = Math.max(0, oldTotal - newTotal);
  const saveMonth = Math.max(0, oldPay - newPay);
  $('save-total').textContent = fmtMoney(saveTotal);
  $('save-month').textContent = fmtMoney(saveMonth);
  $('ribbon-save').textContent = `Ahorro: ${fmtMoney(saveTotal)}`;
}

// Listeners
inputs.forEach(el=>el.addEventListener('input', computeAll));

// Valores por defecto visibles al cargar
$('capPend').value = '150.000';
$('yearsLeft').value = '25';
$('tinOld').value = '3,00';
$('tinNew').value = '2,10';
$('feePct').value = '0,15';
$('otherCosts').value = '900';

// Primer render
computeAll();
</script>
</body>
</html>
